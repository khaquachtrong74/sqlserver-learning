Đề kiểm tra thực hành

1. 
ALTER TABLE CTHD
ADD CONSTRAINT CHK_CTHD_SL_Positive
CHECK(SL > 0)
2. 
ALTER TABLE KHACHHANG
ADD CONSTRAINT UQ_KHACHHANG_SoDT
UNIQUE(SoDT)
3. ALTER TABLE HOADON
ADD CONSTRAINT DF_HOADON_NgayHD
DEFAULT(GETDATE()) FOR NgayHD
4. INSERT INTO KHACHHANG(HoKH, TenKH, DChi, SoDT, NgSinh, NgayDK)
VALUES("Quach", "Kha", "XXX,VVVV", "0987-654-321","01/01/1001", CURENT_DATE)

5. SELECT DiaDiem INTO NhanVIen
UPDATE NhanVien
SET DiaDiem = TP.HCM

Sai, SELECT INTO sẽ tạo bảng mới thay vì thêm cột

ALTER TABLE NhanVien
ADD DiaDiem NVARCHAR(100);
UPDATE NhanVien
SET DiaDiem = TP.HCM

6. SELECT n.MaNV, n.TenNV, A.KhoiLuong
FROM NhanVien n 
LEFT JOIN HOADON h 
ON N.MaNV = h.MaNV, (
SELECT MaHD, COUNT(SL) KhoiLuong
FROM CTHD
GROUP BY MaHD
) A
WHERE h.SoHD = A.MaHD
ORDERBY DESC A.KhoiLuong - SAI

SELECT
n.MaNV, n.TenNV, COUNT(h.SoHD) AS SoDonHang
FROM NhanVien n
LEFT JOIN HoaDon h
ON n.MaNV = h.MaNV
GROUP BY
n.MaNV, n.TenNV
ORDERBY SoDonHang DESC

7. SELECT SUM(C.SL * C.DonGia) AS TongDoanhThu
FROM CTHD C
JOIN HoaDon H
ON C.MaHD = H.SoHD 
WHERE YEAR(H.NgayHD) = 2016

8. SELECT C.*
FROM CTHD C, HoaDon H, KHACHHANG KH
WHERE C.MAHD = H.SoHD
AND H.MaKH NOT IN KH.MaKH

-- SAI LOGIC và bảng tham chiếu

SELECT
FROM SANPHAM S
WHERE NOT EXISTS(
SELECT 1
FROM CTHD C
JOIN HOADON H ON C.MAHOADON
WHERE C.MASP = S.MASP
AND YEAR(H.NGAYHD) = 2016
)

9. SELECT COUNT(*) AS SLSP, S.NuocSX AS TenQuocGia
FROM SANPHAM S
GROUP BY S.NuocSX
ORDER BY SLSP DESC;

10.
SELECT
TENSP,
  ISNULL([1],0) + ISNULL([2],0)
  + ISNULL([3],0) + ISNULL([4],0) AS TongSoLuong,
  ISNULL([1],0) AS Quy1,
  ISNULL([2],0) AS Quy2,
  ISNULL([3],0) AS Quy3,
  ISNULL([4],0) AS Quy4
FROM(
SELECT S.TENSP,
DATEPART(QUARTER, H.NGAYHD) AS QUY,
C.SL
FROM CTHD C
JOIN HOADON H ON C.MAHD = H.SOHD
JOIN SANPHAM S ON C.MASP = S.MASP
WHERE YEAR(H.NGAYHD) = 2016
) AS SRC
PIVOT(
SUM(SL) FOR QUY IN ([1],[2],[3],[4]
) AS PVT
